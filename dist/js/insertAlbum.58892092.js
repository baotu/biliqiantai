(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["insertAlbum"],{"7ee9":function(t,e,s){"use strict";var a=s("9580"),o=s.n(a);o.a},9580:function(t,e,s){},cdc9:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"insertAlbum"},[s("HeaderNav"),s("div",{staticClass:"int-cont"},[s("h3",{staticStyle:{"font-size":"24px",padding:"5px 10px","margin-bottom":"20px"}},[s("span",{directives:[{name:"show",rawName:"v-show",value:!t.albumId,expression:"!albumId"}]},[t._v("新建")]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.albumId,expression:"albumId"}]},[t._v("修改")]),t._v("相簿")]),s("el-form",{attrs:{"label-width":"80px",model:t.form}},[s("el-form-item",{attrs:{label:"上传图片"}},[s("el-upload",{staticClass:"upload-demo",attrs:{name:"filename",drag:"",action:"http://111.230.247.223/SameBWeb/xyalbum/fileuploads.do",multiple:"","show-file-list":!0,"on-success":t.handleAvatarSuccess},model:{value:t.form.files,callback:function(e){t.$set(t.form,"files",e)},expression:"form.files"}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),s("em",[t._v("点击上传")]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.albumId,expression:"albumId"}]},[t._v("(追加图片)")])]),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])]),s("div",{staticClass:"ii",staticStyle:{width:"60%"}},t._l(t.form.files,function(e,a){return s("img",{key:t.photoIds[a],staticClass:"ig",staticStyle:{width:"220px",height:"150px",margin:"10px"},attrs:{src:e},on:{click:function(e){return t.deletePhoto(t.photoIds[a])}}})}),0)],1),s("el-form-item",{attrs:{label:"作品标题"}},[s("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"请输入标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("提交发布")])],1)],1),s("img",{staticClass:"im",attrs:{src:"https://s1.hdslb.com/bfs/static/jinkela/studio/creativecenter-v3/assets/album-draw.e18457f.png",alt:""}})],1),s("Footer")],1)},o=[],i=s("387d"),l=s("9fe9"),n=s("c0d6"),r={components:{HeaderNav:i["a"],Footer:l["a"]},store:n["a"],data:function(){return{photoUploadPercent:"0%",photoFlag:!1,photoIds:[],albumId:"",form:{files:[],title:""}}},mounted:function(){this.$route.query.albumId&&(this.albumId=this.$route.query.albumId,this.getPhoto())},methods:{handleAvatarSuccess:function(t,e){this.form.files.push(t.xyuser),this.photoFlag=!1},getPhoto:function(){var t=this;this.axios.get("xyphoto/findByAlbumId.do",{params:{albumid:this.$route.query.albumId}}).then(function(e){for(var s=0;s<e.data.xyuser.length;s++)t.form.files.push(e.data.xyuser[s].url),t.photoIds.push(e.data.xyuser[s].photoid);t.form.title=e.data.xyuser[0].xyalbum.albumname})},deletePhoto:function(t){var e=this;this.$confirm("是否要将这张相片从本相簿删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.axios.get("xyphoto/deleteById.do",{params:{photoid:t}}).then(function(t){$(".ii").html(""),e.getPhoto()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},onSubmit:function(){var t=this,e=this.form.files.join(",");this.$route.query.albumId?this.axios.get("xyphoto/insertByAlbumid.do",{params:{albumid:this.albumId,url:e}}).then(function(e){t.axios.get("xyalbum/updateById.do",{params:{albumid:t.albumId,albumname:t.form.title}}).then(function(e){1==e.data.xyuser?(t.$message({message:"修改成功！",type:"success",duration:1e3}),t.$router.push({name:"channel"})):(t.$message({message:"修改失败！请重试",type:"error",duration:1e3}),t.$router.push({name:"insertAlbum"}))})}):this.axios.get("xyalbum/insertById.do",{params:{albumname:this.form.title,files:e}}).then(function(e){1==e.data.xyuser?(t.$message({message:"创建成功！",type:"success",duration:1e3}),t.$router.push({name:"channel"})):(t.$message({message:"创建失败！请重试",type:"error",duration:1e3}),t.$router.push({name:"insertAlbum"}))})}}},u=r,m=(s("7ee9"),s("2877")),d=Object(m["a"])(u,a,o,!1,null,"94e2e94c",null);e["default"]=d.exports}}]);
//# sourceMappingURL=insertAlbum.58892092.js.map